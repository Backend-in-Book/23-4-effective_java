---
marp: true
---

# item76: 가능한 한 실패 원자적으로 만들라

---

### 목차

- 실패 원자적
- 실패 원자적으로 만든는 방법

---

### 실패 원자적

---

실패 원자적이란 호출된 메서드가 실패하더라도 해당 객체는 메서드 호출 전 상태를 유지하는 것을 말한다.

---

### 실패 원자적으로 만드는 방법

---

메서드를 실패 원자적으로 만드는 가장 쉬운 방법은 객체를 불변 객체로 설계하는 것이다.

불변 객체의 상태는 생성 시점에 고정되어 절대 변하지 않기 때문에 태생적으로 실패 원자적이다.

불변 객체가 아닌 가변 객체의 메서드를 실패 원자적으로 만드는 가장 흔한 방법은 작업 수행에 앞서 매개변수의 유효성을 검사하는 것이다.

---

```java
public Object pop(){
	if(size == 0){
		throw new EmptyStackException();
  }
	Object result = elements[--size];
	elements[size] = null;
	return result;
}
```

- if문에서 size의 값을 검증하여 예외를 던짐

---

비슷한 취지로 실패할 가능성이 있는 모든 코드를 객체의 상태를 바꾸는 코드보다 앞에 배치하는 방법도 있다.

---

실패 원자성을 얻는 세 번째 방법은 객체의 임시 복사본에서 작업을 수행한 다음, 작업이 성공적으로 완료되면 원래 객체와 교체하는 것이다.
이 방법은 데이터를 임시 자료구조에 저장해 작업하는게 더 빠를 때 적용하기 좋은 방식이다.

---

마지막 방법은 작업 도중 발생하는 실패를 가로채는 복구 코드를 작성하여 작업 전 상태로 되돌리는 방법이다.

자주 쓰이는 방법은 아니다.
